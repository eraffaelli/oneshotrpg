{{ define "head" }}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "headline": "{{ .Title }}",
  "author": {
    "@type": "Organization",
    "name": "One Shot RPG",
    "url": "https://oneshotrpg.com/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "One Shot RPG",
    "url": "https://oneshotrpg.com/"
  },
  "description": "{{- .Summary | plainify -}}",
  "datePublished": "{{ .PublishDate | dateFormat "2006-01-02T15:04:05" }}",
  "dateModified": "{{ .Lastmod | dateFormat "2006-01-02T15:04:05" }}"
}
</script>
{{ end }}
{{ define "main" }}
  <article class="article container">
    <section class="article__title__container">
      <h1 class="article__title">{{ .Title }}</h1>
    </section>
    <div class="row">
      <div class="col-lg-7">
        <section class="article__content">
          {{ .Content }}
        </section>

        {{/* I would use (add .Weight 1) instead of .Params.nextWeight, but the MATCH argument of where doesn't evaluate functions or variables. "where .Site.Pages "Params.weight" (add .Weight 1)" does not work. */}}
        {{ $inNextWeight := where .Site.Pages "Params.weight" .Params.nextWeight }}
        {{ $inSeries := where .Site.Pages "Params.series" .Params.series }}
        {{ $nextArticles := $inNextWeight | intersect $inSeries }}
        {{ if $nextArticles }}
          {{ range first 1 $nextArticles }}
            <aside>
              <p><span class="h4">Read the next article in the series: <a href="{{ .RelPermalink }}">{{ .Title }}</a>.</p>
            </aside>
          {{ end }}
        {{ end }}
      </div>
      <aside class="sidebar col-lg-5">
        <aside class="font-italic">Posted on {{ .Date.Format "January 2, 2006" }}</aside>

        {{ if .TableOfContents }}
          <aside class="d-none d-lg-block">{{ partial "table-of-contents.html" . }}</aside>
        {{ end }}

        {{ partial "in-series.html" . }}

      </aside>
    </div>
  </article>
{{ end }}
